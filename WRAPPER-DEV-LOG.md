# WRAPPER-DEV-LOG

ラッパー開発の進捗・意思決定・課題を記録するログです。日付単位で短く、決定と根拠が追跡できるように記載してください。

テンプレート：

## YYYY-MM-DD
- 背景／スコープ：
- 決定事項：
  - 
- 根拠・検討メモ：
  - 
- 未解決事項：
  - 
- 次アクション：
  - 
- リスク／課題：
  - 
- 参照リンク：
  - `README-FOR-WRAPPER.md` の該当節など

---

## 2025-01-01（初期化例）
- 背景／スコープ：本リポジトリの既存コードを改変せず、`wrapper/` で機能を合成する。
- 決定事項：仕様書は `README-FOR-WRAPPER.md`、ログは本ファイルで管理。
- 根拠・検討メモ：upstream 連携のため、既存ファイルの変更は最小化が必要。
- 未解決事項：最小 CLI の要件確定。
- 次アクション：CLI 雛形の作成、主要ユースケースの列挙。
- リスク／課題：依存バージョン差異／動作環境差異。
- 参照リンク：`AGENTS.md`

---

## 2025-08-28
- 背景／スコープ：Windows 向けラッパーアプリ初期実装。GUI 自動起動と Whisper API 互換のファイル文字起こし API を追加。
- 決定事項：
  - `wrapper/cli/main.py` で `whisperlivekit.basic_server` をサブプロセス起動し、ブラウザを開く。
  - `wrapper/api/server.py` に `/v1/audio/transcriptions` エンドポイントを実装。
- 根拠・検討メモ：既存コードを変更せず WebSocket `/asr` を利用するため、ffmpeg で PCM 変換後に WebSocket へストリーム。
- 未解決事項：エラーハンドリングの詳細、設定ファイル化。
- 次アクション：設定テンプレートの整備、PyInstaller/MSIX での配布検証。
- リスク／課題：ffmpeg 未インストール環境での利用者体験、依存ライブラリのバージョン差異。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-09-14
- 背景／スコープ：Whisper モデルや話者分離モデルを GUI から指定したいとの要望。
- 決定事項：
  - ラッパー GUI に Whisper モデル、話者分離（segmentation/embedding）モデル、Hugging Face ログインボタンを追加。
  - 設定ファイルに `model`、`diarization`、`segmentation_model`、`embedding_model` を保存し、旧設定はデフォルト値で補完。
- 根拠・検討メモ：Web GUI との機能差を縮め、追加設定の永続化と既存ユーザーの移行を自動化するため。
- 未解決事項：Hugging Face トークンの更新・失効の扱い。
- 次アクション：ユーザーからのフィードバック収集と UI 改善検討。
- リスク／課題：外部コマンド失敗時のユーザー通知、モデルダウンロードに伴う初回起動の遅延。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節、設定節。

---

## 2025-09-15
- 背景／スコープ：指定可能なモデルを分かりやすくするため GUI の入力方法を改善。
- 決定事項：
  - Whisper モデルをプルダウン選択にし、`available_models.md` の一覧から候補を読み込む。
  - 話者分離用 `Segmentation model`・`Embedding model` に既定モデルのプルダウンを追加し、任意のモデル ID も手入力できるようにした。
- 根拠・検討メモ：公式で提供されるモデル名を明示しつつ、拡張モデルの指定も柔軟に行えるようにするため。
- 未解決事項：候補リストをオンラインから動的取得するかは未検討。
- 次アクション：利用者からの追加モデル要望を収集し、必要に応じて候補を更新。
- リスク／課題：`available_models.md` のフォーマット変更による読み込み失敗。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-08-30
- 背景／スコープ：MSIX 形式での配布を想定し、必要な追加実装とドキュメント整備を検討。
- 決定事項：
  - MSIX ビルド手順を仕様書に追記。
  - `wrapper/scripts/build_msix.ps1` を雛形として追加。
- 根拠・検討メモ：PyInstaller→makeappx→signtool のフローが一般的であり、設定移行も必要。
- 未解決事項：`AppxManifest.xml` の詳細、署名証明書の扱い。
- 次アクション：ビルドスクリプトの実装詳細と設定移行ロジックの検討。
- リスク／課題：証明書管理、MSIX パッケージの検証手間。
- 参照リンク：`README-FOR-WRAPPER.md` の MSIX パッケージング節。

---

## 2025-08-31
- 背景／スコープ：GUI からポート番号を指定し、API の起動・停止と自動起動モードを追加。
- 決定事項：
  - `wrapper/app/gui.py` にポート入力フィールドと Start/Stop ボタン、Auto-start チェックを実装。
  - `wrapper/api/server.py` が環境変数 `WRAPPER_BACKEND_HOST`/`WRAPPER_BACKEND_PORT` を参照。
- 根拠・検討メモ：環境依存値を GUI で柔軟に操作し、ユーザー操作で API を制御できるようにするため。
- 未解決事項：設定値の永続化、GUI のレイアウト改善。
- 次アクション：設定保存機構の検討と自動テストの追加。
- リスク／課題：サブプロセス管理の安定性、ポート競合時のユーザー通知。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-09-02
- 背景／スコープ：ポート自動割り当てとエンドポイント表示機能の追加。
- 決定事項：
  - GUI 起動時に空きポートを自動選択し入力欄へ表示する。
  - Backend Web UI・WebSocket `/asr`・ファイル文字起こし API の各エンドポイントを GUI に表示し、コピー用ボタンを設置する。
- 根拠・検討メモ：ポート競合の回避とエンドポイント共有の利便性向上のため。
- 未解決事項：設定値の永続化方式。
- 次アクション：設定保存機構の検討。
- リスク／課題：起動直後に他プロセスが同ポートを使用する可能性。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-09-05
- 背景／スコープ：ラッパー側 GUI に WebSocket 録音機能とエンドポイント入力欄を追加。
- 決定事項：
  - `wrapper/app/gui.py` に録音開始/停止ボタン、音量表示、タイマー、文字起こし結果の表示欄を実装。
  - WebSocket URL を編集可能にし、コピー機能を提供。
- 根拠・検討メモ：ブラウザを開かずにラッパーのみで簡易録音・確認ができるようにするため。
- 未解決事項：録音設定の永続化、依存ライブラリのバイナリ配布。
- 次アクション：録音データ保存機能の検討と設定保存方式の検討。
- リスク／課題：`sounddevice` 未インストール環境での利用者体験、WebSocket 接続エラー時のハンドリング不足。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節、実行・セットアップ節。

---

## 2025-09-06
- 背景／スコープ：Web GUI にある設定（テーマ選択）をラッパー GUI に実装し、録音文字起こし結果の保存先を指定可能にする。
- 決定事項：
  - Tkinter GUI に System/Light/Dark のテーマ選択を追加し、即時反映。
  - 文字起こし結果の保存パス入力とファイル選択ダイアログを実装し、録音終了時に自動保存。
- 根拠・検討メモ：Web GUI との機能差を埋め、録音結果の活用方法を拡張。
- 未解決事項：テーマ設定および保存先の永続化方法。
- 次アクション：設定保存機能の検討。
- リスク／課題：ダークテーマ時の ttk スタイル調整のばらつき。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節、実行・セットアップ節。

---

## 2025-09-07
- 背景／スコープ：ユーザーの要望によりテーマ切り替え機能を削除し、録音結果保存のみを維持。
- 決定事項：
  - Tkinter GUI からテーマ選択 UI と関連処理を除去。
- 根拠・検討メモ：機能過多を避け、必要最小限の録音補助に集中するため。
- 未解決事項：設定値（保存先など）の永続化方式。
- 次アクション：設定保存機能の検討。
- リスク／課題：視覚的なカスタマイズができなくなったことによる一部ユーザーの不満。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-09-09
- 背景／スコープ：Web GUI へのリンク、ライセンス表示、設定永続化の要望対応。
- 決定事項：
  - Tkinter GUI に `Open Web GUI` と `License` ボタンを追加。
  - 設定をホームディレクトリ `~/.whisperlivekit-wrapper.json` に保存・読み込み。
- 根拠・検討メモ：ブラウザを手動で開かずに Web GUI へアクセスでき、ライセンス確認と設定再利用の利便性が向上するため。
- 未解決事項：設定ファイルのバージョン管理と上位互換性の維持。
- 次アクション：設定項目の拡張時にマイグレーション手順を検討。
- リスク／課題：権限の制限された環境でホームディレクトリへの書き込みに失敗する可能性。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節、設定節。

---

## 2025-09-10
- 背景／スコープ：MSIX 配布時の権限制約を考慮し、設定ファイルの保存先を再設計。
- 決定事項：
  - `platformdirs` を用いて OS 共通のユーザー設定ディレクトリに `settings.json` を保存。
  - 旧 `~/.whisperlivekit-wrapper.json` が存在する場合は初回起動時に新ディレクトリへ自動移行。
  - 依存ライブラリを `requirements.txt` に集約。
- 根拠・検討メモ：MSIX ではホームディレクトリ書き込みが制限される可能性があり、`platformdirs` による保存が安全なため。
- 未解決事項：設定ファイルのスキーマ変更時のバージョン管理。
- 次アクション：MSIX パッケージ化手順の具体化と自動テスト整備。
- リスク／課題：`platformdirs` への依存追加によるサイズ増加、異なる OS でのパス検証。
- 参照リンク：`README-FOR-WRAPPER.md` の設定節、MSIX パッケージング節。

---

## 2025-09-11
- 背景／スコープ：GUI レイアウトの刷新とリサイズ対応、スタイル改善。
- 決定事項：
  - `wrapper/app/gui.py` をセクション分割し、`ttk.Labelframe` で整理。
  - `ttk.Style` に `clam` テーマと余白設定を適用し、視認性を改善。
  - ウィンドウサイズに合わせて各ウィジェットが拡縮するよう `grid` に weight/sticky を設定。
- 根拠・検討メモ：レイアウトが固定で操作性が悪いとの指摘があり、視認性向上が求められたため。
- 未解決事項：
  - テーマのさらなるカスタマイズや追加テーマ対応。
- 次アクション：
  - 利用者フィードバックをもとに細かな調整を検討。
- リスク／課題：
  - Tkinter のテーマが環境によって異なる表示になる可能性。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節。

---

## 2025-09-14
- 背景／スコープ：Whisper モデルや話者分離モデルを GUI から指定したいとの要望。
- 決定事項：
  - ラッパー GUI に Whisper モデル、話者分離（segmentation/embedding）モデル、Hugging Face ログインボタンを追加。
  - 設定ファイルに `model`、`diarization`、`segmentation_model`、`embedding_model` を保存し、旧設定はデフォルト値で補完。
- 根拠・検討メモ：Web GUI との機能差を縮め、追加設定の永続化と既存ユーザーの移行を自動化するため。
- 未解決事項：Hugging Face トークンの更新・失効の扱い。
- 次アクション：ユーザーからのフィードバック収集と UI 改善検討。
- リスク／課題：外部コマンド失敗時のユーザー通知、モデルダウンロードに伴う初回起動の遅延。
- 参照リンク：`README-FOR-WRAPPER.md` のインターフェース節、設定節。
